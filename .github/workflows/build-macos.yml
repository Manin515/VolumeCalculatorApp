name: Build macOS Application

on:
  push:
    branches: [ main ]

jobs:
  build-macos:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python 3.8
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Build application (full output)
      run: |
        echo "=== Starting py2app build ==="
        python setup.py py2app
        echo "=== Build finished with exit code: $? ==="
        
    - name: Check what was built
      run: |
        echo "=== Current directory structure ==="
        ls -la
        echo "=== Build folder ==="
        ls -la build/ 2>/dev/null || echo "No build folder"
        echo "=== Dist folder ==="
        ls -la dist/ 2>/dev/null || echo "No dist folder"
        echo "=== Searching for any .app files ==="
        find . -name "*.app" -type d 2>/dev/null | head -10 || echo "No .app files found anywhere"
        
    - name: Try alternative build method
      run: |
        echo "=== Trying py2app with different options ==="
        rm -rf build dist 2>/dev/null || true
        python setup.py py2app --packages=matplotlib,numpy,sympy,tkinter
        
    - name: Check alternative build
      run: |
        echo "=== After alternative build ==="
        ls -la dist/ 2>/dev/null || echo "No dist folder after alternative build"
